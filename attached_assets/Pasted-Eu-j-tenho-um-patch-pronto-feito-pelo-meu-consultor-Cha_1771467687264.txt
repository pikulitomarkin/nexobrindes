Eu já tenho um patch pronto feito pelo meu consultor (ChatGPT). NÃO quero que você invente outra solução nem refaça a fórmula do zero.

O que você deve fazer é APENAS aplicar os arquivos que vou te enviar, nos caminhos corretos, sobrescrevendo os existentes, e depois rodar os testes de consistência.

MOTIVO DO PATCH
Hoje o sistema calcula preço usando costPrice. Porém 92% dos produtos estão com costPrice == basePrice (custo contaminado). Isso faz o sistema aplicar a fórmula em cima do preço já pronto (markup em cima de markup), deixando tudo caro.
O patch cria uma regra segura:
- Se costPrice estiver 0/nulo OU costPrice == basePrice -> usar basePrice como preço final (NÃO recalcular markup).
- Se costPrice for um custo real diferente de basePrice -> calcular preço com a fórmula normal (markup divisor).

OBJETIVO
Garantir que o preço mostrado em Admin > Produtos seja o MESMO preço usado ao adicionar o produto em Orçamentos:
- Admin > Orçamentos
- Vendedor > Orçamentos

ARQUIVOS DO PATCH (5)
1) NOVO: client/src/lib/pricingCalc.ts
2) ALTERADO: client/src/pages/admin/products.tsx
3) ALTERADO: client/src/pages/admin/budgets.tsx
4) ALTERADO: client/src/pages/vendor/budgets.tsx
5) ALTERADO: server/storage.pg.ts

O QUE FAZER AGORA (PASSO A PASSO)
1) Eu vou te enviar esses 5 arquivos. Para cada arquivo:
   - crie/abra o caminho exato
   - cole o conteúdo exatamente como enviado
   - sobrescreva o arquivo atual
2) Confirme que o projeto compila sem erros.
3) Reinicie o servidor (restart do Replit).
4) Faça o teste:
   a) Admin > Produtos: anote o preço exibido de um produto
   b) Admin > Orçamentos: adicione o mesmo produto -> unitPrice deve ser igual
   c) Vendedor > Orçamentos: adicione o mesmo produto -> unitPrice deve ser igual
5) Importante: após o patch, a função/ação “Recalcular Preços” NÃO pode mais sobrescrever cost_price = base_price. O arquivo server/storage.pg.ts foi ajustado para impedir essa contaminação.

ENTREGÁVEL
Depois de aplicar, me diga:
- “Arquivos aplicados com sucesso” + lista dos 5 caminhos
- Resultado do teste de consistência (preços bateram em Produtos/AdminBudget/VendorBudget)
- Se houve algum erro de build e em qual arquivo/linha
Como você manda os arquivos pra ele
Você tem dois jeitos:

Upload do ZIP pequeno com “changed_files” e pedir pra ele extrair mantendo as pastas; ou

Colar arquivo por arquivo no chat do Replit (geralmente funciona bem com 5 arquivos).

Se você me disser qual dos dois você vai usar (ZIP ou colar), eu te mando uma frase final específica pra anexar junto (tipo: “vou mandar agora o ZIP, extraia na raiz e sobrescreva”).
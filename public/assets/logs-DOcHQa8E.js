import{r as d,u as G,h as f,j as e,B,R as k,C as l,f as n,A as H,i as P,U as V,g as y,d as w,e as b,L as o,S as q,I as M,k as g,l as v,m as p,n as N,o as t,p as $,q as z,s as J,t as K}from"./index-BRFPqsdC.js";function Q(){const x=JSON.parse(localStorage.getItem("user")||"{}"),c=x.id,[r,C]=d.useState(""),[h,L]=d.useState("all"),[u,E]=d.useState("all"),[j,A]=d.useState("today");G();const{data:i=[],isLoading:S,refetch:T}=f({queryKey:["/api/vendor/logs",c,{search:r,action:h,level:u,date:j}],queryFn:async()=>{const s=new URLSearchParams({vendorId:c,search:r,action:h,level:u,date:j}),a=await fetch(`/api/vendor/logs?${s}`);if(!a.ok)throw new Error("Failed to fetch vendor logs");return a.json()},refetchInterval:3e4}),{data:D=[]}=f({queryKey:["/api/vendors",c,"clients"],queryFn:async()=>{const s=await fetch(`/api/vendors/${c}/clients`);return s.ok?s.json():[]}}),I=s=>new Date(s).toLocaleString("pt-BR"),O=s=>{switch(s){case"error":return{icon:K,color:"text-red-600 bg-red-50"};case"warning":return{icon:J,color:"text-yellow-600 bg-yellow-50"};case"success":return{icon:y,color:"text-green-600 bg-green-50"};default:return{icon:z,color:"text-blue-600 bg-blue-50"}}},R=s=>{switch(s){case"CREATE":return"bg-green-100 text-green-800";case"UPDATE":return"bg-blue-100 text-blue-800";case"DELETE":return"bg-red-100 text-red-800";case"LOGIN":return"bg-purple-100 text-purple-800";case"LOGOUT":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},U=s=>{switch(s){case"CREATE":return"CRIAR";case"UPDATE":return"ATUALIZAR";case"DELETE":return"EXCLUIR";case"LOGIN":return"LOGIN";case"LOGOUT":return"LOGOUT";default:return s}},m=i.filter(s=>!r||s.action.toLowerCase().includes(r.toLowerCase())||s.description.toLowerCase().includes(r.toLowerCase())||s.userName.toLowerCase().includes(r.toLowerCase()));return S?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"grid grid-cols-3 gap-6 mb-8",children:[...Array(3)].map((s,a)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-xl"},a))})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Meus Logs do Sistema"}),e.jsx("p",{className:"text-gray-600",children:"Histórico das suas ações e dos seus clientes"}),e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Vendedor: ",e.jsx("strong",{children:x.name})]})]}),e.jsxs(B,{variant:"outline",onClick:()=>T(),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Logs"}),e.jsx("p",{className:"text-3xl font-bold gradient-text",children:i.length})]}),e.jsx(H,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Hoje"}),e.jsx("p",{className:"text-3xl font-bold gradient-text",children:i.filter(s=>{const a=new Date().toDateString();return new Date(s.createdAt).toDateString()===a}).length})]}),e.jsx(P,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Meus Clientes"}),e.jsx("p",{className:"text-3xl font-bold gradient-text",children:D.length})]}),e.jsx(V,{className:"h-8 w-8 text-purple-600"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ações Hoje"}),e.jsx("p",{className:"text-3xl font-bold gradient-text",children:i.filter(s=>{const a=new Date().toDateString();return new Date(s.createdAt).toDateString()===a&&["CREATE","UPDATE"].includes(s.action)}).length})]}),e.jsx(y,{className:"h-8 w-8 text-emerald-600"})]})})})]}),e.jsxs(l,{children:[e.jsx(w,{children:e.jsx(b,{children:"Filtros"})}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"search",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(M,{id:"search",placeholder:"Buscar logs...",value:r,onChange:s=>C(s.target.value),className:"pl-9"})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Ação"}),e.jsxs(g,{value:h,onValueChange:L,children:[e.jsx(v,{children:e.jsx(p,{})}),e.jsxs(N,{children:[e.jsx(t,{value:"all",children:"Todas as Ações"}),e.jsx(t,{value:"CREATE",children:"Criação"}),e.jsx(t,{value:"UPDATE",children:"Atualização"}),e.jsx(t,{value:"DELETE",children:"Exclusão"}),e.jsx(t,{value:"LOGIN",children:"Login"}),e.jsx(t,{value:"LOGOUT",children:"Logout"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Nível"}),e.jsxs(g,{value:u,onValueChange:E,children:[e.jsx(v,{children:e.jsx(p,{})}),e.jsxs(N,{children:[e.jsx(t,{value:"all",children:"Todos os Níveis"}),e.jsx(t,{value:"info",children:"Info"}),e.jsx(t,{value:"warning",children:"Warning"}),e.jsx(t,{value:"error",children:"Error"}),e.jsx(t,{value:"success",children:"Success"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Período"}),e.jsxs(g,{value:j,onValueChange:A,children:[e.jsx(v,{children:e.jsx(p,{})}),e.jsxs(N,{children:[e.jsx(t,{value:"today",children:"Hoje"}),e.jsx(t,{value:"week",children:"Esta Semana"}),e.jsx(t,{value:"month",children:"Este Mês"}),e.jsx(t,{value:"all",children:"Todos"})]})]})]})]})})]}),e.jsxs(l,{children:[e.jsx(w,{children:e.jsxs(b,{children:["Histórico de Atividades (",m.length,")"]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum log encontrado com os filtros aplicados."}):m.map(s=>{const{icon:a,color:F}=O(s.level);return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${F}`,children:e.jsx(a,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($,{className:R(s.action),children:U(s.action)}),e.jsxs("span",{className:"text-sm text-gray-600",children:["por ",e.jsx("strong",{children:s.userName||x.name})]}),e.jsx("span",{className:"text-sm text-gray-500",children:I(s.createdAt)})]}),e.jsx("p",{className:"text-gray-900 mb-1",children:s.description}),s.details&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded mt-2",children:[e.jsx("strong",{children:"Detalhes:"})," ",typeof s.details=="string"?s.details:JSON.stringify(s.details,null,2)]})]})]})},s.id)})})})]})]})}export{Q as default};

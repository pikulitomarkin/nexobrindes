import{r as i,j as e,c as d,a as h,u as j,b as f,T as v,C as x,d as N,e as b,R as c,f as u,B as w,g as C}from"./index-BRFPqsdC.js";const y=h("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=i.forwardRef(({className:s,variant:a,...r},l)=>e.jsx("div",{ref:l,role:"alert",className:d(y({variant:a}),s),...r}));o.displayName="Alert";const R=i.forwardRef(({className:s,...a},r)=>e.jsx("h5",{ref:r,className:d("mb-1 font-medium leading-none tracking-tight",s),...a}));R.displayName="AlertTitle";const n=i.forwardRef(({className:s,...a},r)=>e.jsx("div",{ref:r,className:d("text-sm [&_p]:leading-relaxed",s),...a}));n.displayName="AlertDescription";function E(){const[s,a]=i.useState(!1),[r,l]=i.useState(null),{toast:m}=j(),g=f({mutationFn:async()=>{const t=await fetch("/api/admin/recalculate-commissions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Erro ao recalcular comissões");return t.json()},onSuccess:t=>{l(t),m({title:"Sucesso!",description:"Comissões recalculadas com sucesso"})},onError:t=>{m({title:"Erro",description:t.message||"Erro ao recalcular comissões",variant:"destructive"})},onSettled:()=>{a(!1)}}),p=()=>{a(!0),l(null),g.mutate()};return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Correção de Comissões Pós-Migração"}),e.jsx("p",{className:"text-gray-600",children:"Ferramenta para recalcular comissões de pedidos existentes após a migração"})]}),e.jsxs("div",{className:"grid gap-6 max-w-2xl",children:[e.jsxs(o,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(v,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(n,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Importante:"})," Esta ferramenta foi criada para corrigir comissões que podem ter sido perdidas durante a migração para PostgreSQL. Use apenas se as comissões dos vendedores e sócios estiverem zeradas ou incorretas."]})]}),e.jsxs(x,{children:[e.jsx(N,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5"}),"Recalcular Comissões"]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Esta operação irá:"}),e.jsxs("ul",{className:"text-sm text-gray-600 list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Verificar todos os pedidos existentes no sistema"}),e.jsx("li",{children:"Identificar pedidos sem comissões calculadas"}),e.jsx("li",{children:"Recalcular comissões de vendedores (baseado na taxa individual)"}),e.jsx("li",{children:"Recalcular comissões de sócios (15% dividido igualmente entre todos os sócios)"}),e.jsx("li",{children:"Manter comissões existentes intactas"})]}),e.jsx("div",{className:"pt-4",children:e.jsx(w,{onClick:p,disabled:s,className:"w-full",children:s?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-4 w-4 mr-2 animate-spin"}),"Recalculando Comissões..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Iniciar Recálculo"]})})})]})})]}),r&&e.jsx(x,{className:"border-green-200 bg-green-50",children:e.jsxs(u,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-800",children:"Recálculo Concluído"})]}),e.jsx("p",{className:"text-green-700 text-sm",children:r.message})]})}),e.jsx(o,{children:e.jsxs(n,{children:[e.jsx("strong",{children:"Após o recálculo:"})," Verifique os painéis dos vendedores e sócios para confirmar que as comissões estão sendo exibidas corretamente. As comissões dos vendedores ficarão pendentes até que os pedidos sejam entregues."]})})]})]})}export{E as default};
